<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.38">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="stylesheet" href="/css/index.css"><title>前端性能与优化 | Mr.KLeo的分享网站</title><meta name="description" content="自我成长之路">
    <link rel="modulepreload" href="/blog/assets/app.1a715263.js"><link rel="modulepreload" href="/blog/assets/frontopti.html.571e638d.js"><link rel="modulepreload" href="/blog/assets/frontopti.html.ea2785c6.js">
    <link rel="stylesheet" href="/blog/assets/style.b681493e.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/blog/" class=""><img class="logo" src="/blog/images/logo.JPG" alt="Mr.KLeo的分享网站"><span class="site-name can-hide">Mr.KLeo的分享网站</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/blog/interview/" class="" aria-label="面经复盘"><!--[--><!--]--> 面经复盘 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/knowledge/" class="router-link-active" aria-label="面试题"><!--[--><!--]--> 面试题 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/wrongexam/" class="" aria-label="笔试错题总结"><!--[--><!--]--> 笔试错题总结 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/books/" class="" aria-label="编程书籍资源"><!--[--><!--]--> 编程书籍资源 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/lizhuang-zhi" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/blog/interview/" class="" aria-label="面经复盘"><!--[--><!--]--> 面经复盘 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/knowledge/" class="router-link-active" aria-label="面试题"><!--[--><!--]--> 面试题 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/wrongexam/" class="" aria-label="笔试错题总结"><!--[--><!--]--> 笔试错题总结 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/books/" class="" aria-label="编程书籍资源"><!--[--><!--]--> 编程书籍资源 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/lizhuang-zhi" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">面试题 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/knowledge/css.html" class="sidebar-item" aria-label="CSS面试题"><!--[--><!--]--> CSS面试题 <!--[--><!--]--></a><!----></li><li><a href="/blog/knowledge/js.html" class="sidebar-item" aria-label="JavaScript面试题"><!--[--><!--]--> JavaScript面试题 <!--[--><!--]--></a><!----></li><li><a href="/blog/knowledge/http.html" class="sidebar-item" aria-label="HTTP"><!--[--><!--]--> HTTP <!--[--><!--]--></a><!----></li><li><a href="/blog/knowledge/vue.html" class="sidebar-item" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a><!----></li><li><a href="/blog/knowledge/wxprogram.html" class="sidebar-item" aria-label="微信小程序"><!--[--><!--]--> 微信小程序 <!--[--><!--]--></a><!----></li><li><a href="/blog/knowledge/webpack.html" class="sidebar-item" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a><!----></li><li><a href="/blog/knowledge/algorithm.html" class="sidebar-item" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a><!----></li><li><a href="/blog/knowledge/designmode.html" class="sidebar-item" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a><!----></li><li><a href="/blog/knowledge/summary.html" class="sidebar-item" aria-label="知识小节"><!--[--><!--]--> 知识小节 <!--[--><!--]--></a><!----></li><li><a href="/blog/knowledge/answerinput.html" class="sidebar-item" aria-label="根据代码看输出（系列）"><!--[--><!--]--> 根据代码看输出（系列） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="前端性能与优化"><!--[--><!--]--> 前端性能与优化 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/knowledge/frontopti.html#为什么不推荐用多层css选择器" class="router-link-active router-link-exact-active sidebar-item" aria-label="为什么不推荐用多层css选择器"><!--[--><!--]--> 为什么不推荐用多层css选择器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#浏览器是如何渲染网页的-伴随问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="浏览器是如何渲染网页的（伴随问题！）"><!--[--><!--]--> 浏览器是如何渲染网页的（伴随问题！） <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/knowledge/frontopti.html#什么是重绘和回流" class="router-link-active router-link-exact-active sidebar-item" aria-label="什么是重绘和回流"><!--[--><!--]--> 什么是重绘和回流 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#强制回流的例子" class="router-link-active router-link-exact-active sidebar-item" aria-label="强制回流的例子"><!--[--><!--]--> 强制回流的例子 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#排版引擎解析css选择器时要从右往左解析" class="router-link-active router-link-exact-active sidebar-item" aria-label="排版引擎解析CSS选择器时要从右往左解析"><!--[--><!--]--> 排版引擎解析CSS选择器时要从右往左解析 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#从浏览器地址栏输入url到页面显示的过程-浏览器都经历了什么" class="router-link-active router-link-exact-active sidebar-item" aria-label="从浏览器地址栏输入URL到页面显示的过程，浏览器都经历了什么？"><!--[--><!--]--> 从浏览器地址栏输入URL到页面显示的过程，浏览器都经历了什么？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#浏览器是怎样解析html页面的" class="router-link-active router-link-exact-active sidebar-item" aria-label="浏览器是怎样解析HTML页面的？"><!--[--><!--]--> 浏览器是怎样解析HTML页面的？ <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/knowledge/frontopti.html#css的阻塞情况" class="router-link-active router-link-exact-active sidebar-item" aria-label="CSS的阻塞情况"><!--[--><!--]--> CSS的阻塞情况 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#阻塞dom的解析型" class="router-link-active router-link-exact-active sidebar-item" aria-label="阻塞dom的解析型"><!--[--><!--]--> 阻塞dom的解析型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#不阻塞dom的解析型" class="router-link-active router-link-exact-active sidebar-item" aria-label="不阻塞dom的解析型"><!--[--><!--]--> 不阻塞dom的解析型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#外联-js-的三种加载过程" class="router-link-active router-link-exact-active sidebar-item" aria-label="外联 js 的三种加载过程"><!--[--><!--]--> 外联 js 的三种加载过程 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#window-onload和domcontentloaded有什么区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="window.onload和DOMContentLoaded有什么区别？"><!--[--><!--]--> window.onload和DOMContentLoaded有什么区别？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#高性能代码" class="router-link-active router-link-exact-active sidebar-item" aria-label="高性能代码"><!--[--><!--]--> 高性能代码 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/knowledge/frontopti.html#条件判断" class="router-link-active router-link-exact-active sidebar-item" aria-label="条件判断"><!--[--><!--]--> 条件判断 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#循环语句" class="router-link-active router-link-exact-active sidebar-item" aria-label="循环语句"><!--[--><!--]--> 循环语句 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#字符串处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="字符串处理"><!--[--><!--]--> 字符串处理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#浏览器的限制" class="router-link-active router-link-exact-active sidebar-item" aria-label="浏览器的限制"><!--[--><!--]--> 浏览器的限制 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#异步任务优化长线任务" class="router-link-active router-link-exact-active sidebar-item" aria-label="异步任务优化长线任务"><!--[--><!--]--> 异步任务优化长线任务 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#避免多重求值" class="router-link-active router-link-exact-active sidebar-item" aria-label="避免多重求值"><!--[--><!--]--> 避免多重求值 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#使用位操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="使用位操作"><!--[--><!--]--> 使用位操作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#使用原生方法" class="router-link-active router-link-exact-active sidebar-item" aria-label="使用原生方法"><!--[--><!--]--> 使用原生方法 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#渲染优化" class="router-link-active router-link-exact-active sidebar-item" aria-label="渲染优化"><!--[--><!--]--> 渲染优化 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog/knowledge/frontopti.html#阻塞渲染" class="router-link-active router-link-exact-active sidebar-item" aria-label="阻塞渲染"><!--[--><!--]--> 阻塞渲染 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#js-动画优化" class="router-link-active router-link-exact-active sidebar-item" aria-label="JS 动画优化"><!--[--><!--]--> JS 动画优化 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#事件防抖与节流" class="router-link-active router-link-exact-active sidebar-item" aria-label="事件防抖与节流"><!--[--><!--]--> 事件防抖与节流 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#使用-bem-规范-简化样式查找" class="router-link-active router-link-exact-active sidebar-item" aria-label="使用 BEM 规范（简化样式查找）"><!--[--><!--]--> 使用 BEM 规范（简化样式查找） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#减少回流和重绘" class="router-link-active router-link-exact-active sidebar-item" aria-label="减少回流和重绘"><!--[--><!--]--> 减少回流和重绘 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#降低绘制的复杂度" class="router-link-active router-link-exact-active sidebar-item" aria-label="降低绘制的复杂度"><!--[--><!--]--> 降低绘制的复杂度 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog/knowledge/frontopti.html#能谈谈前端性能优化的方案吗" class="router-link-active router-link-exact-active sidebar-item" aria-label="能谈谈前端性能优化的方案吗？"><!--[--><!--]--> 能谈谈前端性能优化的方案吗？ <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="前端性能与优化" tabindex="-1"><a class="header-anchor" href="#前端性能与优化" aria-hidden="true">#</a> 前端性能与优化</h1><h2 id="为什么不推荐用多层css选择器" tabindex="-1"><a class="header-anchor" href="#为什么不推荐用多层css选择器" aria-hidden="true">#</a> 为什么不推荐用多层css选择器</h2><blockquote><h4 id="如何减少-css-选择器性能损耗" tabindex="-1"><a class="header-anchor" href="#如何减少-css-选择器性能损耗" aria-hidden="true">#</a> 如何减少 CSS 选择器性能损耗？</h4><p>Google 资深web开发工程师 <a href="https://link.jianshu.com/?t=http://stevesouders.com/" target="_blank" rel="noopener noreferrer">Steve Souders<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 对 CSS 选择器的执行效率从高到低做了一个排序：</p><blockquote><p>1.id选择器（#myid） 2.类选择器（.myclassname） 3.标签选择器（div,h1,p） 4.相邻选择器（h1+p） 5.子选择器（ul &lt; li） 6.后代选择器（li a） 7.通配符选择器（*） 8.属性选择器（a[rel=&quot;external&quot;]） 9.伪类选择器（a:hover, li:nth-child）</p></blockquote></blockquote><p>根据以上「选择器匹配」与「选择器执行效率」原则，我们可以通过避免不恰当的使用，提升 CSS 选择器性能。</p><ol><li><p>避免使用通用选择器</p><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.content *</span> <span class="token punctuation">{</span><span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>浏览器匹配文档中所有的元素后分别向上逐级匹配 class 为 content 的元素，直到文档的根节点。因此其匹配开销是非常大的，所以应避免使用关键选择器是通配选择器的情况。</p></li><li><p>避免使用标签或 class 选择器限制 id 选择器</p><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">BAD
button#backButton</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>
<span class="token selector">BAD
.menu-left#newMenuIcon</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>
<span class="token selector">GOOD
#backButton</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>
<span class="token selector">GOOD
#newMenuIcon</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li><li><p>避免使用标签限制 class 选择器</p><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">BAD
treecell.indented</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>
<span class="token selector">GOOD
.treecell-indented</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>
<span class="token selector">BEST
.hierarchy-deep</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li><li><p><strong>避免使用多层标签选择器。使用 class 选择器替换，减少css查找</strong></p><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">BAD
treeitem[mailfolder=&quot;true&quot;] &gt; treerow &gt; treecell</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>
<span class="token selector">GOOD
.treecell-mailfolder</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li><li><p>避免使用子选择器</p><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">BAD
treehead treerow treecell</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>
<span class="token selector">BETTER, BUT STILL BAD 
treehead &gt; treerow &gt; treecell</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>
<span class="token selector">GOOD
.treecell-header</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li><li><p>使用继承</p><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">BAD 
#bookmarkMenuItem &gt; .menu-left</span> <span class="token punctuation">{</span> <span class="token property">list-style-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>blah<span class="token punctuation">)</span></span> <span class="token punctuation">}</span>
<span class="token selector">GOOD
#bookmarkMenuItem</span> <span class="token punctuation">{</span> <span class="token property">list-style-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>blah<span class="token punctuation">)</span></span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ol><h2 id="浏览器是如何渲染网页的-伴随问题" tabindex="-1"><a class="header-anchor" href="#浏览器是如何渲染网页的-伴随问题" aria-hidden="true">#</a> <strong>浏览器是如何渲染网页的</strong>（伴随问题！）</h2><blockquote><p>浏览器开发团队的图</p></blockquote><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvg8j8qfzuj60hc08174k02.jpg" style="zoom:120%;"><blockquote><p>自画图（不完整了，后面有完整的）</p></blockquote><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvgbrxefc3j321n0u0znl.jpg" style="zoom:100%;"><p>通过图，我们可以知道浏览器是将我们的静态资源<code>HTML</code>文件通过<code>HTML Parser</code>解析成<code>DOM Tree</code>，在建立<code>Render Tree</code>时，浏览器会为<code>DOM Tree</code>中的<code>DOM</code>元素根据<code>CSS</code>的解析结果（<code>Style Rules</code>）来确定生成怎样的<code>Render Object</code>。对于每个DOM元素，必须在所有<code>Style Rules</code>中找到符合的<code>selector</code>并将对应的规则进行合并。选择器的==解析（后面有一个相关问题）==实际是在这里执行的。</p><p><img src="http://www.nowamagic.net/librarys/images/201405/2014_05_04_02.gif" alt="img"></p><p>基于DOM树的一些可视（visual）的节点，WebKit来根据需要来创建相应的RenderObject节点，这些节点也构成了一颗树，称之为<strong>Render树</strong>。基于Render树，WebKit也会根据需要来为它们中的某些节点创建新的RenderLayer节点，从而形成一棵RenderLayer树。</p><p>Render树和RenderLayer树是WebKit支持渲染所提供的基础但是却非常重要的设施。这是因为WebKit的布局计算依赖它们，浏览器的渲染和GPU硬件加速也都依赖于它们。幸运地是，得益于它们接口定义的灵活性，不同的浏览器可以很方便地来实现自己的渲染和加速机制。</p><blockquote><p>Render Tree 的建立</p></blockquote><p>是基于DOM树建立的一颗新的树，Render树节点与DOM树节点不是一一对应关系：</p><ul><li>DOM树的document节点需要建立Render节点；</li><li>DOM树中的可视化节点，例如HTML，BODY，DIV等，非可视化节点不会建立Render树节点，例如HEAD，META，SCRIPT等；</li><li>某些情况下需要建立匿名的Render节点，该节点不对应于DOM树中的任何节点；</li></ul><blockquote><p>参考资料</p></blockquote><h3 id="什么是重绘和回流" tabindex="-1"><a class="header-anchor" href="#什么是重绘和回流" aria-hidden="true">#</a> 什么是重绘和回流</h3><blockquote><p>重绘（Repaint）</p></blockquote><p>当页面元素样式的改变不影响元素在文档流中的位置时（例如<strong>background-color, border-color,visibility</strong>）,浏览器只会将新样式赋予元素并进行重绘操作。（==在Painting阶段==）</p><blockquote><p>回流（Reflow）</p></blockquote><p>当改变影响文档内容或者结构，或者元素位置时，回流操作就会被触发（==Layout阶段==）一般有以下几种情况：</p><ul><li>DOM操作（对元素的增删改，顺序变化等）；</li><li>内容变化，包括表单区域内的文本改变；</li><li>CSS属性的更改或重新计算；</li><li>增删样式表内容；</li><li>修改class属性；</li><li>浏览器窗口变化（滚动或缩放）；</li><li>伪类样式激活（<strong>:hover</strong>等）。</li></ul><blockquote><p>因为浏览器的渲染是先经过<code>Layout</code>然后才是<code>Painting</code>，所以==重绘不一定会引起回流，但是回流一定引起重绘！==</p></blockquote><h3 id="强制回流的例子" tabindex="-1"><a class="header-anchor" href="#强制回流的例子" aria-hidden="true">#</a> 强制回流的例子</h3><p>获取某个元素的属性会触发强制回流</p><h3 id="排版引擎解析css选择器时要从右往左解析" tabindex="-1"><a class="header-anchor" href="#排版引擎解析css选择器时要从右往左解析" aria-hidden="true">#</a> 排版引擎解析CSS选择器时要从右往左解析</h3><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvgcfyi9gtj60zm0lotaq02.jpg" style="zoom:57%;"><p>例如找 <code>#next div</code></p><p>因为正向解析，先从<code>body</code>开始遍历，然后到<code>#header</code>，然后找<code>#header</code>的第一个孩子节点<code>a</code>，如果不是要找的，回溯到前一个节点，然后一直这样找，直到找到<code>#next</code>下的<code>div</code>标签。通过这样的回溯算法，执行效率是很低的！</p><p>但是如果通过逆向解析，自下而上的去匹配，先从最右边的<code>a</code>标签开始，因为要找的是<code>div</code>，所以直接排除，然后是下一个div标签，满足一个情况，接着网上看他的父元素，发现是<code>#header</code>，和我要找的<code>#next</code>不匹配，再排除，然后依次往后这样去遍历，这样的时间复杂度就是<code>O(n)</code>，比前一种效率高很多。(==这一段的解释感觉不太正确！！==)</p><h2 id="从浏览器地址栏输入url到页面显示的过程-浏览器都经历了什么" tabindex="-1"><a class="header-anchor" href="#从浏览器地址栏输入url到页面显示的过程-浏览器都经历了什么" aria-hidden="true">#</a> 从浏览器地址栏输入URL到页面显示的过程，浏览器都经历了什么？</h2><p>一个分为四个部分：</p><ol><li>网络线程的开启（网络进程发起请求并从服务器下载静态资源）</li><li>建立 HTTP 连接（ DNS 解析、TCP 连接）</li><li>前后端交互（反响代理服务器、涉及 HTTP 特性、强缓存和协商缓存）</li><li>页面渲染（对第三步中获取的 HTML、CSS、JS 资源进行布局渲染）</li></ol><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw5haljfirj310q0otwgj.jpg" alt=""></p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw5h9o5h8mj30yw0q70u7.jpg" alt=""></p><p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gw6pwnxw4mj325c0e80u7.jpg" alt=""></p><p>涉及到 JS 处理在最前面的原因，去看阻塞渲染！</p><h2 id="浏览器是怎样解析html页面的" tabindex="-1"><a class="header-anchor" href="#浏览器是怎样解析html页面的" aria-hidden="true">#</a> 浏览器是怎样解析HTML页面的？</h2><p>整个<code>DOM</code>的解析过程是顺序的，并且<code>渐进式</code>的。</p><p><code>渐进式</code>指的是浏览器会迫不及待的将解析完成的部分显示出来，如果我们做下面这个实验会发现，在<code>断点</code>处第一个<code>div</code>已经在浏览器渲染出来了：</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        first div
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">debugger</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        second div
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="css的阻塞情况" tabindex="-1"><a class="header-anchor" href="#css的阻塞情况" aria-hidden="true">#</a> CSS的阻塞情况</h3><ol><li><p>css不会阻塞dom的解析</p></li><li><p>css会阻塞dom的渲染</p></li><li><p>css会阻塞js（js会阻塞dom，从而间接阻塞dom解析，但前提是js之前的css）</p></li></ol><h3 id="阻塞dom的解析型" tabindex="-1"><a class="header-anchor" href="#阻塞dom的解析型" aria-hidden="true">#</a> 阻塞dom的解析型</h3><ol><li><p>内联 js</p></li><li><p>外联普通 js</p></li><li><p><strong>js 标签之前的 css</strong>（js 需要等前面的 css <code>&lt;内联或外联&gt;</code>加载完毕后，才开始执行，而 js 会阻塞<code>dom树</code>的解析，所以外联css 会间接阻塞<code>dom树</code>的解析）</p></li></ol><h3 id="不阻塞dom的解析型" tabindex="-1"><a class="header-anchor" href="#不阻塞dom的解析型" aria-hidden="true">#</a> 不阻塞dom的解析型</h3><ol><li><p>image、iframe、audio</p></li><li><p>外联 async js（<strong>其实这里是可能阻塞，也可能不阻塞，需要根据 js 脚本的下载结束时间来决定</strong>）</p></li><li><p><strong>外联 defer js</strong>（<code>defer javascript</code>是在<code>dom树</code>构建完成后，<code>DOMContentLoaded</code>事件派发之前请求并执行的）</p></li><li><p>js 标签之后的 css</p></li></ol><h3 id="外联-js-的三种加载过程" tabindex="-1"><a class="header-anchor" href="#外联-js-的三种加载过程" aria-hidden="true">#</a> 外联 js 的三种加载过程</h3><ul><li>外联普通javascript</li></ul><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>indx.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>外联defer javascript</li></ul><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">defer</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>indx.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>外联async javascript</li></ul><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">async</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>indx.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>如下图所示，绿色表示<code>html</code>解析；灰色表示<code>html</code>解析暂停；紫色表示<code>外联javascript</code>加载；粉色表示<code>javascript执行</code>。</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1gzmc7i06ajj20ji04jwei.jpg" alt=""></p><p>第一种外联普通 js，会阻塞<code>dom树</code>的解析。加载执行过程如下：</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1gzmc8viqfwj20lb02wq2u.jpg" alt=""></p><p>第二种外联 defer js 不阻塞 html 解析，而是会暂存到一个队列中，等整个 html 解析完成后，再按照队列的顺序请求并执行 js，但是<mark>这种外联 defer js 全部加载并执行完成后才会派发<code>DOMContentLoaded</code>事件</mark>，加载过程如下：</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1gzmcc8fxwvj20la02q746.jpg" alt=""></p><p><strong>第三种外联 async js 不阻塞 html 的解析过程，但是这里说的只是在 js 下载的过程不阻塞 html 的解析，如果 js 下载完成后 html 还没有解析完，则会暂停 html 解析，先执行下载完的 js ，然后再继续解析 html。过程如下：</strong></p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1gzmcfqonmbj20lc02kglj.jpg" alt=""></p><p>详细情况：</p><p><a href="https://zhuanlan.zhihu.com/p/43282197" target="_blank" rel="noopener noreferrer">css加载会造成阻塞吗？<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://juejin.cn/post/6844903745730396174" target="_blank" rel="noopener noreferrer">浏览器是如何解析html的？ - 掘金<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="window-onload和domcontentloaded有什么区别" tabindex="-1"><a class="header-anchor" href="#window-onload和domcontentloaded有什么区别" aria-hidden="true">#</a> <code>window.onload</code>和<code>DOMContentLoaded</code>有什么区别？</h2><ul><li><p><code>window.onload</code>事件是在所有资源都加载完成（这些资源包括css、js、图片视频等）后，才执行</p></li><li><p>html文档加载并解析完成，但是图片等资源还未完成加载，触发<code>DOMContentLoaded</code>事件</p><p>但是实际上对于<code>DOMContentLoaded</code>事件还是分两种情况：</p><ol><li><p>如果页面中同时存在 js 和 css，并且 js 在 css 后面，则<code>DOMContentLoaded</code>事件会在 css 加载完后才执行</p></li><li><p>其他情况，<code>DOMContentLoaded</code>都不会等待css加载，并且DOMContentLoaded事件也不会等待图片、视频等其他资源加载。</p></li></ol></li></ul><p><a href="https://zhuanlan.zhihu.com/p/43282197" target="_blank" rel="noopener noreferrer">css加载会造成阻塞吗？<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="高性能代码" tabindex="-1"><a class="header-anchor" href="#高性能代码" aria-hidden="true">#</a> 高性能代码</h2><h3 id="条件判断" tabindex="-1"><a class="header-anchor" href="#条件判断" aria-hidden="true">#</a> 条件判断</h3><ul><li>当要匹配的条件仅为一两个离散值时，或者容易划分不同取值范围时，使用 if-else 语句</li><li>当要匹配的条件超过一两个但少于十个离散值，使用 switch 语句</li><li>超过十个，使用基于数组索引或者对象属性的查找方式</li></ul><h3 id="循环语句" tabindex="-1"><a class="header-anchor" href="#循环语句" aria-hidden="true">#</a> 循环语句</h3><ul><li><code>for-of</code>性能优于 <code>for-in</code>和<code>forEach</code>，但是逊色于三种常规循环语句（for、while、do-while）</li><li>任何的递归都可转化为迭代，使用递归需要考虑浏览器对调用栈的大小限制</li></ul><h3 id="字符串处理" tabindex="-1"><a class="header-anchor" href="#字符串处理" aria-hidden="true">#</a> 字符串处理</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> len <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>len<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        str <span class="token operator">+=</span> <span class="token string">&#39;a&#39;</span> <span class="token operator">+</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">foo2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> len <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>len<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        str <span class="token operator">=</span> str <span class="token operator">+</span> <span class="token string">&#39;a&#39;</span> <span class="token operator">+</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>函数 foo1的 while 循环中需要我们先创建一个临时变量用来存储 &#39;ab&#39;，然后再将这个临时变量和 str 变量进行拼接，最后再赋值给变量 str</p><p>而在函数 foo2 中，我们不需要去创建一个临时变量来存储 &#39;ab&#39;，而是直接将 &#39;ab&#39; 和 str 进行拼接，这在大部分浏览器中，将会提高 20% 的执行速度</p><h3 id="浏览器的限制" tabindex="-1"><a class="header-anchor" href="#浏览器的限制" aria-hidden="true">#</a> 浏览器的限制</h3><p>引起 JS 执行时间过长的原因：</p><ol><li>对 DOM 的频繁修改</li><li>不恰当的循环</li><li>过深的递归</li></ol><p>虚拟 DOM ：就是将真实的 DOM 抽象为 JS 对象，让 JS 对象去执行修改的中间过程，最后统一修改，这样就降低了频繁的操作 DOM 所带来的性能影响。</p><h3 id="异步任务优化长线任务" tabindex="-1"><a class="header-anchor" href="#异步任务优化长线任务" aria-hidden="true">#</a> <strong>异步任务优化长线任务</strong></h3><p>异步任务中的事件循环机制，这里不过多赘述，主要是讲利用异步任务对复杂计算（长任务）进行拆分处理，优化单线程的 JS 引擎执行效率</p><blockquote><p>不阻塞页面渲染的快速响应</p></blockquote><p>当我们创建一个异步任务后，它并没有马上执行，而是被 JS 引擎放置到一个队列中，当执行完一个任务脚本后，JS 引擎便会挂起让浏览器去做其他工作，比如更新页面，当页面更新完成后，JS 引擎便会查看任务队列，并取出一个任务执行。</p><p>据此我们便有了对执行长任务的一种优化策略，将一个长任务拆分为多个异步任务，从而让浏览器给刷新页面留出时间。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 模拟复杂计算</span>
    <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sum <span class="token operator">+=</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 模拟将复杂的程序拆分话</span>
<span class="token keyword">function</span> <span class="token function">bigProcedure</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 将复杂任务拆分执行</span>
        <span class="token keyword">const</span> item <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">process</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token function">bigProcedure</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
            <span class="token comment">// setTimeout(arguments.callee(arr), 100)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>   <span class="token comment">// 设置100ms是因为这在用户的感知卡顿时间内</span>
<span class="token punctuation">}</span>

<span class="token function">bigProcedure</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// 45</span>
<span class="token comment">// 190</span>
<span class="token comment">// 435</span>
<span class="token comment">// 780</span>
<span class="token comment">// 1225</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="避免多重求值" tabindex="-1"><a class="header-anchor" href="#避免多重求值" aria-hidden="true">#</a> 避免多重求值</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* 
    避免多重求值
*/</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token string">&quot;result = a + b&quot;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token string">&quot;result = a + b&quot;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
result <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;a + b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;result = a + b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>以上代码，首先会以正常的方式进行一次求值，接着在执行过程中对字符串的代码进行一次额外的求值运算</p><h3 id="使用位操作" tabindex="-1"><a class="header-anchor" href="#使用位操作" aria-hidden="true">#</a> 使用位操作</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 不使用位运算</span>
<span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 找到偶数</span>
        sum <span class="token operator">+=</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 使用位运算</span>
<span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">// 找到偶数</span>
        sum <span class="token operator">+=</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>位操作通常发生在系统底层，可以极大的代码的执行效率。</p><h3 id="使用原生方法" tabindex="-1"><a class="header-anchor" href="#使用原生方法" aria-hidden="true">#</a> 使用原生方法</h3><p>原生方法是我们在编写 JS 代码之前就已经存在于浏览器中，并且大多数都是用更底层的语言实现的，可以被编译成执行效率更高的机器码，所以我们要尽量的使用原生方法。而非自我编写的一些 JS 代码</p><h2 id="渲染优化" tabindex="-1"><a class="header-anchor" href="#渲染优化" aria-hidden="true">#</a> 渲染优化</h2><h3 id="阻塞渲染" tabindex="-1"><a class="header-anchor" href="#阻塞渲染" aria-hidden="true">#</a> 阻塞渲染</h3><p>JS可以操作DOM来修改DOM结构，可以操作CSSOM来修改节点样式，这就导致了浏览器在遇到<code>&lt;script&gt;</code>标签时，DOM构建将暂停，直至脚本完成执行，然后继续构建DOM。如果脚本是外部的，会等待脚本下载完毕，再继续解析文档。现在可以在<code>script</code>标签上增加属性<code>defer</code>或者<code>async</code>。脚本解析会将脚本中改变DOM和CSS的地方分别解析出来，追加到DOM树和CSSOM规则树上。</p><p>每次去执行JavaScript脚本都会严重地阻塞DOM树的构建，如果JavaScript脚本还操作了CSSOM，而正好这个CSSOM还没有下载和构建，浏览器甚至会延迟脚本执行和构建DOM，直至完成其CSSOM的下载和构建。所以，<code>script</code>标签的位置很重要。</p><p>JS阻塞了构建DOM树，也阻塞了其后的构建CSSOM规则树，整个解析进程必须等待JS的执行完成才能够继续，这就是所谓的JS阻塞页面。</p><p>由于CSSOM负责存储渲染信息，浏览器就必须保证在合成渲染树之前，CSSOM是完备的，这种完备是指所有的CSS（内联、内部和外部）都已经下载完，并解析完，只有CSSOM和DOM的解析完全结束，浏览器才会进入下一步的渲染，这就是CSS阻塞渲染。</p><p>CSS阻塞渲染意味着，在CSSOM完备前，页面将一直处理白屏状态，这就是为什么样式放在<code>head</code>中，仅仅是为了更快的解析CSS，保证更快的首次渲染。</p><p>需要注意的是，即便你没有给页面任何的样式声明，CSSOM依然会生成，默认生成的CSSOM自带浏览器默认样式。</p><p>当解析HTML的时候，会把新来的元素插入DOM树里面，同时去查找CSS，然后把对应的样式规则应用到元素上，查找样式表是按照从右到左的顺序去匹配的。</p><p>例如：<code>div p {font-size: 16px}</code>，会先寻找所有<code>p</code>标签并判断它的父标签是否为<code>div</code>之后才会决定要不要采用这个样式进行渲染）。 所以，我们平时写CSS时，尽量用<code>id</code>和<code>class</code>，千万不要过渡层叠。</p><h3 id="js-动画优化" tabindex="-1"><a class="header-anchor" href="#js-动画优化" aria-hidden="true">#</a> JS 动画优化</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> start<span class="token punctuation">;</span>
<span class="token comment">// 定义目标动画元素</span>
<span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;myAnimate&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">&#39;absolute&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// 定义动画回调函数</span>
<span class="token keyword">function</span> <span class="token function">updateScreen</span><span class="token punctuation">(</span><span class="token parameter">timestamp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>start<span class="token punctuation">)</span> start <span class="token operator">=</span> timestamp<span class="token punctuation">;</span>
    <span class="token comment">// 根据时间戳计算每次动画位移</span>
    <span class="token keyword">const</span> progress <span class="token operator">=</span> timestamp <span class="token operator">-</span> start<span class="token punctuation">;</span>
    element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>progress <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>progress <span class="token operator">&lt;</span> <span class="token number">2000</span><span class="token punctuation">)</span> window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>updateScreen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 启动动画回调函数</span>
window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>updateScreen<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>使用 window.requestAnimationFrame 比使用 setInterval 去设置动画更优。</p><ol><li>window.requestAnimationFrame 的执行时机与系统的刷新频率同步</li><li>当页面会激活时，屏幕刷新任务会被系统暂停（而 setInterval 需要显示的销毁定时器）</li></ol><h3 id="事件防抖与节流" tabindex="-1"><a class="header-anchor" href="#事件防抖与节流" aria-hidden="true">#</a> 事件防抖与节流</h3><blockquote><p>节流</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>onscroll <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 业务代码</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 设置定时器</span>
    <span class="token keyword">var</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 当不存在定时器时，我们为其设置一个定时器，并进行执行内容</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// 执行内容</span>
                <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
                timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>   <span class="token comment">// 定时器存在时，直接返回</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><blockquote><p>防抖</p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> inputitem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;inputitem&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
inputitem<span class="token punctuation">.</span>oninput <span class="token operator">=</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> timeout</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 有就清理掉</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> timeout <span class="token operator">||</span> <span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="使用-bem-规范-简化样式查找" tabindex="-1"><a class="header-anchor" href="#使用-bem-规范-简化样式查找" aria-hidden="true">#</a> 使用 BEM 规范（简化样式查找）</h3><p>一种CSS书写规范</p><h3 id="减少回流和重绘" tabindex="-1"><a class="header-anchor" href="#减少回流和重绘" aria-hidden="true">#</a> 减少回流和重绘</h3><p>导致回流的原因：</p><ol><li>对 DOM 元素几何属性的修改（例如 width、height、padding、top）</li><li>对 DOM 树的结构进行更改</li><li>获取某些特定的属性值（例如 offsetTop、offsetLeft、offsetWidth等）</li></ol><p>减少的方式：</p><ol><li><p>使用类名对样式逐条修改</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 获取 DOM，逐行修改</span>
<span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;mydiv&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token string">&#39;100px&#39;</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">&#39;200px&#39;</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>border <span class="token operator">=</span> <span class="token string">&#39;2px solid blue&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>上面的方式，每一行都会触发一次渲染树的更改，导致多次回流。更好的做法是</p><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.mydiv</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 2px solid blue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>然后统一添加类</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;mydiv&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
div<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&#39;mydiv&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>缓存对敏感属性值的计算</p><p>就是说不要直接使用 offsetTop 这些属性进行计算，而是将他们存储在一个变量中，进行计算，最后统一操作</p></li><li><p>使用 requestAnimationFrame 方法控制渲染帧</p></li></ol><h3 id="降低绘制的复杂度" tabindex="-1"><a class="header-anchor" href="#降低绘制的复杂度" aria-hidden="true">#</a> 降低绘制的复杂度</h3><p>在绘制的过程中，对于不同的 CSS 样式，其实绘制的性能是不同的。</p><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">#foo</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 绘制时间相对较短 */</span>
    <span class="token property">border-color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
    <span class="token comment">/* 绘制时间相对较长 */</span>
    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 8px <span class="token function">rgb</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 220<span class="token punctuation">,</span> 12<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>所以对于类似阴影这样的样式，我们可以通过 PS 给图片本身加阴影，而非使用 CSS</p><h2 id="能谈谈前端性能优化的方案吗" tabindex="-1"><a class="header-anchor" href="#能谈谈前端性能优化的方案吗" aria-hidden="true">#</a> <mark>能谈谈前端性能优化的方案吗？</mark></h2><p>（1）减少http请求数量</p><p>在浏览器与服务器进行通信时，主要是通过 HTTP 进行通信。浏览器与服务器需要经过三次握手，每次握手需要花费大量时间。而且不同浏览器对资源文件并发请求数量有限（不同浏览器允许并发数），一旦 HTTP 请求数量达到一定数量，资源请求就存在等待状态，这是很致命的，因此减少 HTTP 的请求数量可以很大程度上对网站性能进行优化。</p><ul><li><strong>减少重定向请求次数</strong></li></ul><ul><li><strong>CSS Sprites</strong></li></ul><p>国内俗称CSS精灵，这是将多张图片合并成一张图片达到减少HTTP请求的一种解决方案，可以通过CSS的background属性来访问图片内容。这种方案同时还可以减少图片总字节数。</p><ul><li><strong>合并CSS和JS文件</strong></li></ul><p>现在前端有很多工程化打包工具，如：grunt、gulp、webpack等。为了减少 HTTP 请求数量，可以通过这些工具再发布前将多个CSS或者多个JS合并成一个文件。</p><ul><li>base64编码图片并嵌入HTML文件,一并返回</li></ul><p>还可以将图⽚的⼆进制数据⽤ base64 编码后，以 URL 的形式潜⼊到 HTML ⽂件，跟随 HTML ⽂件⼀并发送.</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>&lt;image
src=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAAFKCAIAAAC7M9WrAAAACXBIWXMAA
... /&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><strong>采用lazyload</strong></li></ul><p>俗称懒加载，可以控制网页上的内容在一开始无需加载，不需要发请求，等到用户操作真正需要的时候立即加载出内容。这样就控制了网页资源一次性请求数量。</p><p>（2）减少HTTP响应数据大小</p><ul><li><p>无损压缩 (常见gzip、deflate、br)</p><p>客户端发送请求时,会在请求头中书写客户端支持的压缩算法</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Accept-Encoding: gzip, deflate, br
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>收到请求后, 服务端选择其中一个压缩算法进行响应数据压缩,并在响应头中告知客户端自身使用的压缩算法</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>content-encoding: <span class="token function">gzip</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>有损压缩</p><ul><li>通过牺牲一些质量来减少数据量、提高压缩比. 常⽤于压缩多媒体数据，⽐如⾳频、视频、图⽚。</li></ul><p>通过 HTTP 请求头部中的 Accept 字段⾥的「 q 质量因⼦」，告诉服务器期望的资源质量。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Accept: audio/*<span class="token punctuation">;</span> <span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.2</span>, audio/basic
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>图⽚的压缩，⽬前压缩常用的是 Google 推出的 WebP 格式</p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0jk9kfh60j21lw0s2n4q.jpg" alt=""></p><p>相同图⽚质量下，WebP 格式的图⽚⼤⼩都⽐ Png 格式的图⽚⼩.</p><p>对于视频常⻅的编码格式有 H264、H265 等，⾳频常⻅的编码格式有 AAC、AC3。</p></li></ul><p>（3）利用浏览器缓存</p><p>浏览器缓存是将网络资源存储在本地，等待下次请求该资源时，如果资源已经存在就不需要到服务器重新请求该资源，直接在本地读取该资源。</p><p>（4）控制资源文件加载优先级(从css、js阻塞角度去说)</p><p>浏览器在加载HTML内容时，是将HTML内容从上至下依次解析，解析到link或者script标签就会加载href或者src对应链接内容，为了第一时间展示页面给用户，就需要将CSS提前加载，不要受 JS 加载影响。</p><p>一般情况下都是CSS在头部，JS在底部。</p><p>（5）减少重排（Reflow）</p><p>基本原理：重排是DOM的变化影响到了元素的几何属性（宽和高），浏览器会重新计算元素的几何属性，会使渲染树中受到影响的部分失效，浏览器会验证 DOM 树上的所有其它结点的visibility属性，这也是Reflow低效的原因。如果Reflow的过于频繁，CPU使用率就会急剧上升。</p><p>减少Reflow，如果需要在DOM操作时添加样式，尽量使用 增加class属性，而不是通过style操作样式。</p><p>（6）减少 DOM 操作</p><p>（7）尽量外链CSS和JS（结构、表现和行为的分离），保证网页代码的整洁，也有利于日后维护</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>asstes/css/style.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>assets/js/main.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>（8）图标使用IconFont替换</p><p>（9）不使用CSS表达式，会影响效率</p><p>（10）使用CDN网络缓存，加快用户访问速度，减轻服务器压力</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 2315831906@qq.com">mrkleo</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/blog/knowledge/answerinput.html" class="" aria-label="根据代码看输出（系列）"><!--[--><!--]--> 根据代码看输出（系列） <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/blog/assets/app.1a715263.js" defer></script>
  </body>
</html>
